dataloader:
  batch_size: 16
  data_root: data
  num_workers: 1
  train_datasets:
  - params:
      erase_image_with_mask: 0.2
      im_preprocessor_config:
        params:
          horizon_flip: true
          random_crop: true
          size:
          - 256
          - 256
          smallest_max_size: 256
        target: image_synthesis.data.utils.image_preprocessor.SimplePreprocessor
      image_list_file: data/ffhqtrain_69k.txt
      mask: 1.0
      mask_low_size:
      - 32
      - 32
      mask_low_to_high: 0.0
      multi_image_mask: false
      name: ffhq
      provided_mask_name: irregular-mask/testing_mask_dataset
      return_data_keys:
      - image
      - mask
      - erase_mask
      stroken_mask_params:
        keep_ratio:
        - 0.0
        - 0.5
        maxBrushWidth: 30
        maxLength: 100
        maxVertex: 10
        minBrushWidth: 10
        minVertex: 5
        min_area: 64
      use_provided_mask: 0.7
      use_provided_mask_ratio:
      - 0.4
      - 1.0
      zero_mask: 0.3
    target: image_synthesis.data.image_list_dataset.ImageListDataset
  validation_datasets:
  - params:
      erase_image_with_mask: 0.2
      im_preprocessor_config:
        params:
          size:
          - 256
          - 256
          smallest_max_size: 256
        target: image_synthesis.data.utils.image_preprocessor.SimplePreprocessor
      image_list_file: data/ffhqvalidation_1k.txt
      mask: 1.0
      mask_low_size:
      - 32
      - 32
      mask_low_to_high: 0.0
      multi_image_mask: false
      name: ffhq
      provided_mask_name: irregular-mask/testing_mask_dataset
      return_data_keys:
      - image
      - mask
      - erase_mask
      stroken_mask_params:
        keep_ratio:
        - 0.0
        - 0.5
        maxBrushWidth: 30
        maxLength: 100
        maxVertex: 10
        minBrushWidth: 10
        minVertex: 5
        min_area: 64
      use_provided_mask: 0.7
      use_provided_mask_ratio:
      - 0.4
      - 1.0
      zero_mask: 0.3
    target: image_synthesis.data.image_list_dataset.ImageListDataset
model:
  params:
    decoder_config:
      params:
        encoder_downsample_layer: conv
        in_ch: 256
        num_res_block: 8
        out_ch: 3
        res_block_bottleneck: 2
        res_ch: 256
        stride: 8
        up_layer_with_image: true
      target: image_synthesis.modeling.codecs.image_codec.patch_vqgan.PatchConvDecoder2
    encoder_config:
      params:
        in_ch: 3
        num_res_block: 8
        out_ch: 256
        res_block_bottleneck: 2
        res_ch: 256
        stride: 8
      target: image_synthesis.modeling.codecs.image_codec.patch_vqgan.PatchEncoder2
    lossconfig:
      params:
        content_start: 5000
        disc_start: 5000
        g_gradient_loss_weight: 5.0
        gan_loss: nsgan
        gradient_start: 5000
        style_start: 5000
      target: image_synthesis.modeling.modules.edge_connect.losses.EdgeConnectLoss
    quantizer_config:
      params:
        distance_type: euclidean
        e_dim: 256
        embed_ema: true
        get_embed_type: retrive
        masked_embed_start: 512
        n_e: 1024
      target: image_synthesis.modeling.codecs.image_codec.patch_vqgan.VectorQuantizer
    token_shape:
    - 32
    - 32
    trainable: true
  target: image_synthesis.modeling.codecs.image_codec.patch_vqgan.PatchVQGAN
solver:
  adjust_lr: none
  base_lr: 0.0
  max_epochs: 1
  optimizers_and_schedulers:
  - name: generator
    optimizer:
      params:
        betas: !!python/tuple
        - 0.0
        - 0.9
      target: torch.optim.Adam
    scheduler:
      params:
        min_lr: 1.0e-06
        warmup: 5000
        warmup_lr: 0.0002
      step_iteration: 1
      target: image_synthesis.engine.lr_scheduler.CosineAnnealingLRWithWarmup
  - name: discriminator
    optimizer:
      params:
        betas: !!python/tuple
        - 0.0
        - 0.9
      target: torch.optim.Adam
    scheduler:
      params:
        min_lr: 1.0e-06
        warmup: 5000
        warmup_lr: 2.0e-05
      step_iteration: 1
      target: image_synthesis.engine.lr_scheduler.CosineAnnealingLRWithWarmup
  sample_iterations: 5000
  save_epochs: 5
  validation_epochs: 1
